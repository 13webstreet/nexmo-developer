include 'application_generate_jwt.php';

//Connection information
$base_url = 'https://api.nexmo.com' ;
$version = '/v1';
$action = '/calls';

//Call and application information
$application_id = "id-for-your-conversation-application";
//The unique identifier for this Call leg
$uuid = "id-for-your-call";

//Mint your JWT
$keyfile="application_secret_key.txt";
$jwt = generate_jwt($application_id, $keyfile);

//The speech to send
$headers =  array('Content-Type: application/json', "Authorization: Bearer " . $jwt ) ;

//The audio file to stream
$payload = '{
  "text": "But soft, what light from yonder window breaks.",
  "voiceName": "Amy"
}';

$ch = curl_init($base_url . $version . $action  . "/" . $uuid . "/talk" ) ;
curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "PUT");
curl_setopt($ch, CURLOPT_POSTFIELDS, $payload);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
$response = curl_exec($ch);

echo $response;
